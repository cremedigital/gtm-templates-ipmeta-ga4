___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "IpMeta.io for GA4",
  "categories": [
    "ANALYTICS"
  ],
  "brand": {
    "id": "github.com_cremedigital",
    "displayName": "gtm-templates-cremedigital",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Get \u0027Service Provider\u0027 and \u0027Network Domain\u0027 dimensions back into your GA4 properties and register them as custom dimensions. Library and service is provided by ipmeta.io.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "sourceUrl",
    "displayName": "IpMeta Library Source URL",
    "simpleValueType": true,
    "defaultValue": "https://ipmeta.io/plugin.js",
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^https?:\\/\\/.*$"
        ]
      }
    ],
    "help": "Unlikely this URL never needs to change from the default. Double-check against the `src` attribute in the IpMeta code snippet provided during account creation and instructions on the ipmeta.io website."
  },
  {
    "type": "TEXT",
    "name": "ipmetaApiKey",
    "displayName": "IpMeta API Key",
    "simpleValueType": true,
    "canBeEmptyString": true,
    "help": "An API key is optional and you may leave this field empty. Adding an API key will enrich and push more visitor data into the dataLayer. Register an account at ipmeta.io to get one.",
    "alwaysInSummary": true,
    "notSetText": "IpMeta will work without entering a value here, but the data provided will be limited without an API key."
  },
  {
    "type": "CHECKBOX",
    "name": "debug",
    "checkboxText": "Log debug messages to console",
    "simpleValueType": true,
    "alwaysInSummary": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const logToConsole = require('logToConsole');
const queryPermission = require('queryPermission');
const copyFromWindow = require('copyFromWindow');
const url = data.sourceUrl;
const apiKey = data.ipmetaApiKey;

// If the user chose to log debug output, initialize the logging method
const log = data.debug ? logToConsole : (() => {});
log('IpMeta: Loading script from ' + url);

// If the script fails to load, log a message and signal failure
const onFailure = () => {
  log('IpMeta: Script load failed.');
  data.gtmOnFailure();
};

// If the script loaded successfully, log a message and signal success
const onSuccess = () => {
  log('IpMeta: Script loaded successfully.');
  const IpMetaGa4 = copyFromWindow('IpMetaGa4');
  IpMetaGa4({
    gtmEventKey: 'ipmeta_loaded',
    apiKey: apiKey
  });
  log('IpMeta: GTM event name "ipmeta_loaded" should be in the dataLayer if successful');
  data.gtmOnSuccess();
};


// If the URL input by the user matches the permissions set for the template,
// inject the script with the onSuccess and onFailure methods as callbacks.
if (queryPermission('inject_script', url)) {
  injectScript(url, onSuccess, onFailure);
} else {
  log('IpMeta: Script load failed due to permissions mismatch.');
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://ipmeta.io/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "IpMetaGa4"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 12/08/2022, 15:22:50


